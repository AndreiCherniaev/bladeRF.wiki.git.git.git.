This page describes how to use the bladeRF's built-in DC offset and IQ imbalance corrections.

= Overview =

Direct conversion (homodyne or zero-IF) receivers have become very popular recently especially in the realm of software defined radio.  There are many benefits to direct conversion receivers, but there are also some serious drawbacks the largest being DC offset and IQ imbalances.

DC offset manifests itself as a large spike in the center of the spectrum.  This happens in direct conversion receivers due to a few different factors.  One is at the ADC where being off by a single LSB will yield a DC offset.  Another is at the output of the low-pass filters where any DC bias will propagate through.  The last is at the mixer where the local oscillator (LO) being on the center of the desired frequency will leak through to the receiver.

IQ imbalances occur due to the slightest mismatches in sections of the receiver chain when dealing with the I and Q signal paths.  The LO is generated and then delayed by 90 degrees.  When mixed with the original signal, this produces the I signal whereas the Q signal is generated by mixing with the LO that is delayed by 90 degrees.  In the analog domain, it is much harder to guarantee the delay is exactly 90 degrees.  Similarly, the gain component is a slight mismatch in overall gain for each of the signal paths.

To make matters worse, these impairments need to be corrected for over both frequency and temperature.

The LMS6002D transceiver provides DC offset cancellation, and the bladeRF HDL implements IQ imbalance corrections. Correction values for these can be manually specified via libbladeRF's [https://github.com/Nuand/bladeRF/blob/0acf5b1159d087f9f4ffeeaeccd3ab8dd2125b24/host/libraries/libbladeRF/include/libbladeRF.h#L595 bladerf_set_correction()] function.

= Tuning the TX module =

Below is am image showing a spectrum containing a tone before (left) and after (right) manually adjusting the DC offset and IQ imbalance correction parameters.

[[http://nuand.com/~jon/images/wiki/dc_iq_cal_before_after.png]]

== Using a spectrum analyzer and osmocom_siggen ==

# Ensure the bladeRF's FPGA is loaded
# Run osmocom_siggen for the desired frequency:
<pre>
osmocom_siggen -s 4M -f 450M --sine
</pre>
# Specify a frequency offset for the sinusoid

With an uncalibrated device, you'll generally see the following a spectrum plot:
# A spike at DC
# An image of the tone at -F Hz


=== DC offset correction ===

# Move the DC Offset Correction **Real** slider until the amplitude DC spike reaches a local minima
# Move the DC Offset Correction **Imag** slider to further reduce the DC spike
# Repeat until the DC spike is sufficiently canceled
# Record these settings for reference as an initial starting point in the future. 

=== IQ imbalance correction ===

# Move the IQ Imbalance Correction **Mag** slider until the amplitude of the image reaches a local minimum
# Move the IQ Imbalance **Phase** slider to further reduce the amplitude of the image
# Repeat until the image spike is sufficiently canceled
# Record these settings for reference as an initial starting point in the future. 

Note that you many need to re-tune the DC offset or IQ imbalance slightly after fine tuning other.


= Tuning the RX module =

TODO